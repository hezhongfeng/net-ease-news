# netease-news

网易新闻的《二零一七年娱乐圈画传》

## 绘画过程

看了上面的动图，如何实现呢，看了下网易的网页元素，知道了是把图像一帧一帧的画到 canvas 上面的，比如一秒画 60 帧，就能达到这种顺滑的收缩效果

图片也不是一整个大图，而是很多个图，每缩小完一张图，就替换成下一张，继续收缩，这就要求图片的顺序是有排列好的

同时存在着两张图

需要用到这个`CanvasRenderingContext2D.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight)`函数，这个函数的参数比较多，这里列出来：

| 参数    | Description                                     |
| ------- | ----------------------------------------------- |
| image   | 绘制到 canvas 的元素，可以是图片、视频和 canvas |
| sx      | image 的矩形（裁剪）选择框的左上角 X 轴坐标     |
| sy      | image 的矩形（裁剪）选择框的左上角 Y 轴坐标     |
| sWidth  | image 的矩形（裁剪）选择框的宽度                |
| sHeight | image 的矩形（裁剪）选择框的高度                |
| dx      | image 的左上角在目标画布上 X 轴坐标             |
| dy      | image 的左上角在目标画布上 Y 轴坐标             |
| dWidth  | image 在目标画布上绘制的宽度                    |
| dHeight | image 在目标画布上绘制的高度                    |

第一个参数，没啥说的，就是想要绘制的目标元素

`sx`和`sy`，想要剪裁的图片的左上角坐标，如果是`0，0`就是从原图的左上角开始

`sWidth`和`sHeight`,想要剪裁的图片的长宽

以上 4 个参数，互相配合，就可以从 image 上剪出原图的一部分

接下来 `dx dy dWidth dHeight`是针对画布的参数，也就是说在画布上选一块地方将上面裁剪下来的图像放进去。这时候问题来了，如果裁剪的和画布上准备放图像的宽高不一样咋办，好办，拉伸或者收缩

## 收缩细节

最初的时候小图和手机屏幕重合
随着时间的推移，大图和小图都慢慢缩小，最终大图和手机屏幕重合

## 计算公式

我们假设，经过一段时间后，长和宽缩小的系数是 factor，随着这个系数的慢慢变小，变化也越来越大

PIP 代表图中图

### 当前图片

![当前图片](https://cdn.jsdelivr.net/gh/hezhongfeng/images/202302280853151.gif)

当前图片为此时撑满整个屏幕的图片，随着时间的推移，逐渐缩小，最终缩小移动到下一张图片的小图的大小和位置

结合上面的`drawImage`函数的参数，这一过程中，整个图片都在画布中，而且是从图片的左上角开始剪裁的，那么`sx`、`sy`、`sWidth`和`sHeight`这 4 个参数就是`0,0,当前图片的宽度,当前图片的高度`

![image](https://cdn.jsdelivr.net/gh/hezhongfeng/images/202302271546038.svg)

ABCD 手机屏幕的框

EFGH 当前图片的中间态

HIJK 当前图片的最终大小和位置，也就是下一张图片的 PIP 的大小和位置

所以经过一段时间后，有 `EF=AB*factor` 和 `EH = AD*factor`

只需要计算当前图片在屏幕中的位置即可

先计算屏幕中的横坐标`dx`，最初是 0，随着 factor 变小，越来越大，最终是小图片的 left,也就是 HL

```js
NH=EL=RL-RE
ER/HT=AE/AH=AS/AU
ER=HT*AS/AU

所以NH=RL-HT*AS/AU
```

### 下一张图片

这里假设：

ABCD 是手机的屏幕

EFGH 是小图的中间态

HIJK 是小图的最终态

对于大图来讲，每次重绘都是撑满了屏幕的，所以只计算剪裁图片的部分即可

剪裁的点最初在小图的左上角，最终在大图的左上角(也就是 0),ML 为剪裁的横坐标

假设 EF 是一段时间后的剪裁图片的宽度，所以有 `factor = HI/EF`，所以有`EF = HI/factor`，这个值随着 factor 的缩小，变得越来越大，最终剪裁了整个图片

EH 的值一样

然后继续求坐标的变化，最开始剪裁的横坐标在小图的横坐标上，最后是 0，这里需要求 ML 的值

```js
ML = AR;

AR/AT=AE/AH=AS/AU
AS=AB-EF
AU=AB-HI
所以ML=AR=AT*(AB-EF)/(AB-HI)
```
